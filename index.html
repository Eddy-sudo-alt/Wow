<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Schiffe auf Wasser â€” Top-Down mit Sound</title>
<style>
  :root{
    --bg:#e8f9ff; --water1:#bfe8ff; --water2:#5fb0e6; --ui:#ffffffcc; --muted:#123;
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Roboto,Arial;color:var(--muted);background:linear-gradient(180deg,#f8feff,#e8f9ff);}
  header{padding:12px 16px}
  h1{margin:0;font-size:18px}
  .hint{font-size:13px;margin:4px 0 0 0;color:#345}
  .controls{display:flex;gap:8px;padding:10px 16px;align-items:center;flex-wrap:wrap}
  button{background:var(--ui);border:0;padding:8px 12px;border-radius:10px;box-shadow:0 6px 18px rgba(20,50,80,0.06);cursor:pointer}
  .stage-wrap{display:flex;align-items:center;justify-content:center;padding:10px;flex:1}
  .stage{width:100%;max-width:980px;height:74vh;min-height:420px;border-radius:18px;box-shadow:0 14px 40px rgba(20,40,80,0.08);overflow:hidden;position:relative;background:transparent}
  canvas{display:block;width:100%;height:100%}
  footer{padding:10px 16px;font-size:13px;color:#445;text-align:center}
  .panel{position:absolute;left:14px;top:14px;background:var(--ui);padding:8px 10px;border-radius:10px;backdrop-filter:blur(6px);box-shadow:0 4px 12px rgba(0,0,0,0.06)}
  .small{font-size:13px}
  @media (max-width:640px){ h1{font-size:16px} .controls{padding:8px} }
</style>
</head>
<body>
<header>
  <h1>Schiffe auf Wasser â€” Top-Down mit Sound</h1>
  <p class="hint">Meditatives Spiel â€¢ Boote kreisen automatisch â€¢ Tippe/Klicke = Boot hinzufÃ¼gen â€¢ Ziehen zum lenken â€¢ Sound an/aus</p>
</header>

<div class="controls">
  <button id="add">+ Boot</button>
  <button id="addLily">+ Seerose</button>
  <button id="addFish">+ Fisch</button>
  <button id="calm">Beruhigen</button>
  <button id="mute">ðŸ”Š Aus/An</button>
  <div style="flex:1"></div>
  <button id="reset">ZurÃ¼cksetzen</button>
</div>

<div class="stage-wrap">
  <div class="stage" id="stage">
    <canvas id="c"></canvas>
    <div class="panel small" id="info">Boote: 0 â€¢ Seerosen: 0 â€¢ Fische: 0</div>
  </div>
</div>

<footer>Tipp: A fÃ¼r Boot, L fÃ¼r Seerose, F fÃ¼r Fisch â€” Kein Wettbewerb, nur Entspannung.</footer>

<script>
/* --- Schiffe auf Wasser mit Sound --- */
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
let DPR = Math.max(1, devicePixelRatio || 1);
function resize(){ DPR = Math.max(1,devicePixelRatio||1); canvas.width=canvas.clientWidth*DPR; canvas.height=canvas.clientHeight*DPR; }
window.addEventListener('resize',()=>{ resize(); draw(); });
resize();

/* World */
const world = { time:0, boats:[], lilies:[], fish:[], calmFactor:1, speedFactor:1, center:{x:0,y:0}, rx:260, ry:140, muted:false };

/* helpers */
const rand=(a,b)=>Math.random()*(b-a)+a;
const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));

/* Audio */
const audioContext = new (window.AudioContext||window.webkitAudioContext)();
let waterLoop, plopBuffer;
function loadSound(url,cb){ fetch(url).then(r=>r.arrayBuffer()).then(d=>audioContext.decodeAudioData(d,cb)); }
function playPlop(){ if(world.muted || !plopBuffer) return; const s=audioContext.createBufferSource(); s.buffer=plopBuffer; s.connect(audioContext.destination); s.start(); }
function playWaterLoop(){ if(world.muted) return; if(waterLoop) return; const s=audioContext.createBufferSource(); s.buffer=waterLoop; s.loop=true; s.connect(audioContext.destination); s.start(); waterLoopPlayer=s; }

/* load basic sounds (small plop + water ambient) */
loadSound('https://cdn.jsdelivr.net/gh/eddy-website/samples/plop.mp3',b=>plopBuffer=b);
loadSound('https://cdn.jsdelivr.net/gh/eddy-website/samples/waterloop.mp3',b=>{waterLoop=b; playWaterLoop();});

/* Boat class */
class Boat{ constructor(angle,color='#ff9f6a',size=28){ this.angle=angle; this.offset=rand(-12,12); this.speed=rand(0.18,0.36); this.color=color; this.size=size; this.dragging=false; this.id='b_'+Math.random().toString(36).slice(2,9);}
  pos(){ const cx=world.center.x,cy=world.center.y,rx=world.rx,ry=world.ry,a=this.angle; let x=cx+rx*Math.cos(a),y=cy+ry*Math.sin(a); const nx=Math.cos(a),ny=Math.sin(a); x+=this.offset*nx; y+=this.offset*ny; return {x,y};}
  update(dt){ if(!this.dragging){ const wobble=Math.sin(world.time*1.5+(this.id.charCodeAt(2)||0))*0.03; this.angle+=(this.speed*(0.6+0.4*world.calmFactor)+wobble*0.05)*dt*world.speedFactor; this.offset+=Math.sin(world.time*0.7+this.angle*2)*0.02; this.offset=clamp(this.offset,-24,24);} }
  draw(ctx){ const p=this.pos(),s=this.size*DPR; ctx.save(); ctx.translate(p.x*DPR,p.y*DPR); const rx=world.rx,ry=world.ry,a=this.angle; const tx=-rx*Math.sin(a),ty=ry*Math.cos(a); const rot=Math.atan2(ty,tx); ctx.rotate(rot); ctx.beginPath(); ctx.ellipse(0,s*0.14,s*0.8*s*0.5,0,0,Math.PI*2); ctx.fillStyle="rgba(0,0,0,0.08)"; ctx.fill(); ctx.beginPath(); ctx.moveTo(-s*0.6,0); ctx.quadraticCurveTo(0,s*0.7,s*0.6,0); ctx.lineTo(s*0.5,s*0.22); ctx.lineTo(-s*0.5,s*0.22); ctx.closePath(); ctx.fillStyle=this.color; ctx.fill(); ctx.fillStyle='rgba(255,255,255,0.9)'; ctx.fillRect(-s*0.22,-s*0.05,s*0.44,s*0.14); ctx.restore(); }
}

/* Lily & Fish same as previous code (omitted for brevity, can reuse previous classes) */
// ... same as earlier

/* Functions for adding boats, lilies, fish, pointer interactions same as before */

// UI handlers
document.getElementById('add').addEventListener('click',()=>{ addBoat(); playPlop(); });
document.getElementById('addLily').addEventListener('click',addLily);
document.getElementById('addFish').addEventListener('click',addFish);
document.getElementById('calm').addEventListener('click',()=>{ world.calmFactor=0.2; setTimeout(()=>world.calmFactor=1,1200); });
document.getElementById('reset').addEventListener('click',()=>{ world.boats=[]; world.lilies=[]; world.fish=[]; updateInfo(); save(); });
document.getElementById('mute').addEventListener('click',()=>{ world.muted=!world.muted; if(!world.muted) playWaterLoop(); });

// Initialize a few boats
if(world.boats.length===0){ addBoat(0.1); addBoat(2.3); addBoat(4.1); }

/* Animation loop same as previous code */
let last=performance.now();
function frame(now){ const dt=Math.min(0.05,(now-last)/1000); last=now; world.time+=dt; world.boats.forEach(b=>b.update(dt)); world.fish.forEach((f,i)=>{ f.x+=Math.sin(world.time*1.5+i)*0.02; f.y+=Math.cos(world.time*1.9+i)*0.015; }); draw(); requestAnimationFrame(frame); }
requestAnimationFrame(frame);

/* Draw function also includes lilies, fish, boats, water as before */

</script>
</body>
</html>